<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SAYKYO CLUB - Login</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<style>
  :root {
    --primary: #00c8ff;
    --primary-dark: #0088cc;
    --accent: #7b2fff;
    --glass-bg: rgba(255,255,255,0.06);
    --glass-border: rgba(255,255,255,0.15);
    --glass-shadow: rgba(0,200,255,0.1);
    --text: #e8f4ff;
    --text-muted: rgba(232,244,255,0.5);
    --bg-dark: #060c18;
    --error: #ff4d6d;
    --success: #00e5a0;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  
  body {
    font-family: 'Exo 2', sans-serif;
    background: var(--bg-dark);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    color: var(--text);
  }

  /* Animated background */
  .bg-scene {
    position: fixed; inset: 0; z-index: 0;
    background: radial-gradient(ellipse at 20% 50%, rgba(0,100,200,0.3) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 20%, rgba(123,47,255,0.25) 0%, transparent 50%),
                radial-gradient(ellipse at 60% 80%, rgba(0,200,255,0.15) 0%, transparent 50%),
                #060c18;
  }
  .orb {
    position: absolute; border-radius: 50%;
    filter: blur(60px); animation: drift 8s ease-in-out infinite;
  }
  .orb-1 { width:400px;height:400px;background:rgba(0,150,255,0.18);top:-10%;left:-10%;animation-delay:0s; }
  .orb-2 { width:300px;height:300px;background:rgba(123,47,255,0.2);bottom:10%;right:-5%;animation-delay:-3s; }
  .orb-3 { width:200px;height:200px;background:rgba(0,229,160,0.12);top:60%;left:30%;animation-delay:-5s; }
  @keyframes drift {
    0%,100% { transform: translate(0,0) scale(1); }
    33% { transform: translate(30px,-20px) scale(1.05); }
    66% { transform: translate(-20px,30px) scale(0.95); }
  }

  /* Grid lines */
  .grid-overlay {
    position: fixed; inset: 0; z-index: 0; opacity: 0.04;
    background-image: linear-gradient(rgba(0,200,255,1) 1px, transparent 1px),
                      linear-gradient(90deg, rgba(0,200,255,1) 1px, transparent 1px);
    background-size: 50px 50px;
  }

  .login-wrapper {
    position: relative; z-index: 10;
    width: 100%; max-width: 420px;
    padding: 24px;
    animation: slideUp 0.8s cubic-bezier(0.16,1,0.3,1) both;
  }
  @keyframes slideUp {
    from { opacity:0; transform: translateY(40px); }
    to { opacity:1; transform: translateY(0); }
  }

  /* Liquid Glass Card */
  .glass-card {
    background: rgba(10,20,40,0.6);
    backdrop-filter: blur(40px) saturate(180%);
    -webkit-backdrop-filter: blur(40px) saturate(180%);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 28px;
    padding: 48px 40px 40px;
    box-shadow: 
      0 0 0 1px rgba(0,200,255,0.05),
      0 20px 60px rgba(0,0,0,0.5),
      inset 0 1px 0 rgba(255,255,255,0.1),
      0 0 80px rgba(0,100,200,0.08);
    position: relative;
    overflow: hidden;
  }
  .glass-card::before {
    content:'';
    position:absolute; top:0;left:0;right:0;height:1px;
    background: linear-gradient(90deg, transparent, rgba(0,200,255,0.6), rgba(123,47,255,0.6), transparent);
  }
  .glass-card::after {
    content:''; position:absolute;
    top:-100px;left:-100px;width:300px;height:300px;
    background:radial-gradient(circle, rgba(0,150,255,0.08) 0%, transparent 70%);
    pointer-events:none;
  }

  .logo-area { text-align:center; margin-bottom: 36px; }
  .logo-text {
    font-family: 'Space Mono', monospace;
    font-size: 2.4rem; font-weight: 700;
    letter-spacing: 6px;
    background: linear-gradient(135deg, #fff 0%, var(--primary) 50%, var(--accent) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: none;
  }
  .logo-sub {
    font-size: 0.7rem; letter-spacing: 8px;
    color: var(--primary); text-transform: uppercase;
    margin-top: 4px; opacity: 0.8;
  }
  .logo-tagline {
    font-size: 0.85rem; color: var(--text-muted);
    margin-top: 12px; font-weight: 300; letter-spacing: 1px;
  }

  /* Mascots */
  .mascots {
    display: flex; justify-content: center;
    margin-bottom: 28px;
  }
  .mascot-img {
    width: 220px; height: auto;
    object-fit: contain;
    filter: drop-shadow(0 0 20px rgba(0,200,255,0.25));
  }

  /* Form */
  .form-group { margin-bottom: 16px; position: relative; }
  .form-group label {
    display: block; font-size: 0.75rem;
    color: var(--text-muted); letter-spacing: 1px;
    text-transform: uppercase; margin-bottom: 6px;
  }
  .glass-input {
    width: 100%;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 14px;
    padding: 14px 18px;
    color: var(--text); font-family: 'Exo 2', sans-serif;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    outline: none;
  }
  .glass-input:focus {
    border-color: var(--primary);
    background: rgba(0,200,255,0.08);
    box-shadow: 0 0 0 3px rgba(0,200,255,0.12), inset 0 0 20px rgba(0,200,255,0.04);
  }
  .glass-input::placeholder { color: rgba(232,244,255,0.3); }

  .icon-input { position: relative; }
  .icon-input input { padding-left: 46px; }
  .icon-input .input-icon {
    position: absolute; left: 16px; top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted); font-size: 1rem;
  }

  .btn-primary {
    width: 100%; padding: 15px;
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    border: none; border-radius: 14px;
    color: #fff; font-family: 'Exo 2', sans-serif;
    font-size: 1rem; font-weight: 700;
    letter-spacing: 2px; text-transform: uppercase;
    cursor: pointer; margin-top: 8px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 20px rgba(0,200,255,0.3);
    position: relative; overflow: hidden;
  }
  .btn-primary::before {
    content:''; position:absolute; inset:0;
    background: linear-gradient(135deg, transparent, rgba(255,255,255,0.2), transparent);
    transform: translateX(-100%);
    transition: transform 0.5s ease;
  }
  .btn-primary:hover::before { transform: translateX(100%); }
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0,200,255,0.5);
  }
  .btn-primary:active { transform: translateY(0); }

  .loading-state {
    display: none; align-items: center; justify-content: center; gap: 8px;
  }
  .spinner {
    width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3);
    border-top-color: #fff; border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .credits {
    text-align: center; margin-top: 28px;
    color: var(--text-muted); font-size: 0.75rem;
  }
  .credits strong { color: var(--primary); }

  /* Eye toggle */
  .pass-wrapper { position: relative; }
  .pass-wrapper input { padding-right: 46px; }
  .eye-btn {
    position: absolute; right: 14px; top: 50%;
    transform: translateY(-50%);
    background: none; border: none; cursor: pointer;
    color: var(--text-muted); font-size: 1rem;
    padding: 4px; line-height: 1;
    transition: color 0.2s ease;
  }
  .eye-btn:hover { color: var(--primary); }

  /* Remember me */
  .remember-row {
    display: flex; align-items: center; gap: 10px;
    margin-top: 4px; margin-bottom: 4px;
    cursor: pointer;
  }
  .remember-check {
    width: 18px; height: 18px;
    accent-color: var(--primary);
    cursor: pointer;
    flex-shrink: 0;
  }
  .remember-label {
    font-size: 0.82rem; color: var(--text-muted);
    cursor: pointer; user-select: none;
    transition: color 0.2s;
  }
  .remember-row:hover .remember-label { color: var(--text); }

  /* Floating particles */
  .particle {
    position: fixed; pointer-events: none;
    width: 3px; height: 3px;
    border-radius: 50%;
    background: var(--primary);
    animation: float-up linear infinite;
    opacity: 0;
  }
  @keyframes float-up {
    0% { transform: translateY(100vh) translateX(0); opacity:0; }
    10% { opacity: 0.6; }
    90% { opacity: 0.3; }
    100% { transform: translateY(-10vh) translateX(var(--drift)); opacity:0; }
  }

  @media (max-width: 480px) {
    .glass-card { padding: 36px 24px 32px; }
    .logo-text { font-size: 2rem; }
  }
</style>
</head>
<body>

<div class="bg-scene">
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="orb orb-3"></div>
</div>
<div class="grid-overlay"></div>

<!-- LOADING SCREEN -->
<div id="loadingScreen" style="display:flex;position:fixed;inset:0;z-index:200;background:var(--bg-dark);flex-direction:column;align-items:center;justify-content:center;gap:20px">
  <div style="width:80px;height:80px;border:4px solid rgba(0,200,255,0.2);border-top-color:var(--primary);border-radius:50%;animation:spin 1s linear infinite"></div>
  <div style="font-size:1.2rem;font-weight:700;letter-spacing:2px;background:linear-gradient(135deg,#fff,var(--primary));-webkit-background-clip:text;-webkit-text-fill-color:transparent">Iniciando tu sesi√≥n...</div>
  <div style="font-size:0.85rem;color:var(--text-muted)">Por favor espera</div>
</div>

<div class="login-wrapper" id="loginWrapper" style="display:none">
  <div class="glass-card">
    <div class="logo-area">
      <img src="logo_saykyo.png" alt="Saykyo Club" style="height:90px;object-fit:contain;filter:drop-shadow(0 0 16px rgba(0,200,255,0.3))">
      <div class="logo-tagline">Entrena ¬∑ Progresa ¬∑ Supera tus l√≠mites</div>
    </div>

    <div class="mascots">
      <img class="mascot-img" src="boss.png" alt="Saykyo">
    </div>

    <form id="loginForm" autocomplete="off">
      <div class="form-group">
        <div class="icon-input">
          <span class="input-icon">üë§</span>
          <input type="text" id="usuario" class="glass-input" placeholder="Email" autocomplete="off" required>
        </div>
      </div>
      <div class="form-group">
        <div class="icon-input pass-wrapper">
          <span class="input-icon">üîí</span>
          <input type="password" id="contrasena" class="glass-input" placeholder="Contrase√±a" required style="padding-left:46px">
          <button type="button" class="eye-btn" id="eyeBtn" onclick="toggleEye()" title="Ver contrase√±a">üôà</button>
        </div>
      </div>
      <div class="remember-row">
        <input type="checkbox" class="remember-check" id="rememberMe">
        <label class="remember-label" for="rememberMe">Recordarme en este dispositivo</label>
      </div>
      <button type="submit" class="btn-primary" id="loginBtn">
        <span id="btnText">ENTRAR</span>
        <span class="loading-state" id="btnLoading">
          <span class="spinner"></span> Verificando...
        </span>
      </button>
    </form>

    <div class="credits">
      By: <strong>Sebas Moreno</strong> y <strong>Caro Mu√±oz</strong>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCDlQGoWTNtAna8unwVNgJZH8WNRsYF0MU",
  authDomain: "entrenamiento-6b069.firebaseapp.com",
  projectId: "entrenamiento-6b069",
  storageBucket: "entrenamiento-6b069.firebasestorage.app",
  messagingSenderId: "818051143570",
  appId: "1:818051143570:web:c17fa58f4f98ce67b9534b",
  databaseURL: "https://entrenamiento-6b069-default-rtdb.firebaseio.com"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

// Eye toggle
window.toggleEye = () => {
  const inp = document.getElementById('contrasena');
  const btn = document.getElementById('eyeBtn');
  if (inp.type === 'password') {
    inp.type = 'text';
    btn.textContent = 'üôâ';
    btn.title = 'Ocultar contrase√±a';
  } else {
    inp.type = 'password';
    btn.textContent = 'üôà';
    btn.title = 'Ver contrase√±a';
  }
};

// Restore remembered credentials
const remembered = localStorage.getItem('saykyo_remember');
if (remembered) {
  try {
    const { email, password } = JSON.parse(remembered);
    document.getElementById('usuario').value = email || '';
    document.getElementById('contrasena').value = password || '';
    document.getElementById('rememberMe').checked = true;
  } catch(e) {}
}

// Bandera para evitar que onAuthStateChanged redirija mientras el formulario maneja el login
let loginEnProgreso = false;

// Check if already logged in (sesi√≥n previa)
auth.onAuthStateChanged(async (user) => {
  if (user && !loginEnProgreso) {
    // Mantener pantalla de carga visible mientras se verifica
    const snapshot = await get(ref(db, 'usuarios/' + user.uid));
    if (snapshot.exists()) {
      const userData = snapshot.val();
      sessionStorage.setItem('saykyo_user', JSON.stringify({ ...userData, uid: user.uid, id: user.uid }));
      if (userData.rol === 'admin' || userData.rol === 'superadmin') window.location.href = 'dashboard.html';
      else window.location.href = 'entrenamiento.html';
    }
  } else {
    // No hay sesi√≥n activa, mostrar el login
    document.getElementById('loadingScreen').style.display = 'none';
    document.getElementById('loginWrapper').style.display = 'block';
  }
});

// Create floating particles
for (let i = 0; i < 20; i++) {
  const p = document.createElement('div');
  p.className = 'particle';
  p.style.cssText = `
    left: ${Math.random()*100}%;
    animation-duration: ${5+Math.random()*10}s;
    animation-delay: ${-Math.random()*15}s;
    --drift: ${(Math.random()-0.5)*100}px;
    width: ${1+Math.random()*3}px;
    height: ${1+Math.random()*3}px;
    opacity: ${0.2+Math.random()*0.4};
  `;
  document.body.appendChild(p);
}

document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  loginEnProgreso = true;

  const email = document.getElementById('usuario').value.trim();
  const password = document.getElementById('contrasena').value;

  document.getElementById('btnText').style.display = 'none';
  document.getElementById('btnLoading').style.display = 'flex';

  try {

    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    const snapshot = await get(ref(db, 'usuarios/' + user.uid));

    if (!snapshot.exists()) {
      throw new Error("Usuario no configurado correctamente.");
    }

    const userData = snapshot.val();

    if (!userData.activo) {
      throw new Error("Tu cuenta est√° desactivada. Contacta a tu entrenador.");
    }

    if (userData.validoHasta) {
      const now = new Date();
      const valid = new Date(userData.validoHasta);
      if (now > valid) {
        throw new Error("Tu suscripci√≥n ha vencido.");
      }
    }

    // Handle remember me
    if (document.getElementById('rememberMe').checked) {
      localStorage.setItem('saykyo_remember', JSON.stringify({ email, password }));
    } else {
      localStorage.removeItem('saykyo_remember');
    }

    sessionStorage.setItem('saykyo_user', JSON.stringify({
      ...userData,
      uid: user.uid,
      id: user.uid
    }));

    await Swal.fire({
      icon: 'success',
      title: `¬°Bienvenido(a), ${userData.nombres}!`,
      text: userData.rol === 'superadmin' ? '‚≠ê Acceso Super Admin' : userData.rol === 'admin' ? 'Acceso de administrador' : 'Listo para entrenar üí™',
      background: 'rgba(10,20,40,0.95)',
      color: '#e8f4ff',
      confirmButtonColor: '#00c8ff',
      timer: 1500,
      showConfirmButton: false,
      backdrop: 'rgba(0,0,0,0.7)'
    });

    if (userData.rol === 'admin' || userData.rol === 'superadmin') {
      window.location.href = 'dashboard.html';
    } else {
      window.location.href = 'entrenamiento.html';
    }

  } catch (err) {
    loginEnProgreso = false;
    document.getElementById('btnText').style.display = '';
    document.getElementById('btnLoading').style.display = 'none';
    
    // Asegurar que el login est√° visible si hay error
    document.getElementById('loadingScreen').style.display = 'none';
    document.getElementById('loginWrapper').style.display = 'block';

    Swal.fire({
      icon: 'error',
      title: 'Error',
      text: 'No se puede acceder, verifica los datos ingresados o consulta la vigencia de tu acceso con tu entrenador',
      background: 'rgba(10,20,40,0.95)',
      color: '#e8f4ff',
      confirmButtonColor: '#ff4d6d',
      backdrop: 'rgba(0,0,0,0.7)'
    });
  }
});
</script>
</body>
</html>
  
